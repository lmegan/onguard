
<div class="dashboard">
  <div id="d-wrapper">
    <div class="zig-zag-wrapper">
      <div class="zig-zag-bottom" id="welcome">
        <h2>Welcome, <%= @user.first_name %><%= " " %><%= @user.last_name %></h2>
      </div>
      <div class="zig-zag"></div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-6 dashboard-menu">
      <div class="dashboard-menu-item">
        <i class="fas fa-plus" style="color:#9c9c9c" height="50px"></i>
      <button type="button" id="event-button" data-toggle="modal" data-target=".bd-example-modal-lg"><p>Create a new Event</p></button>
      </div>
    </div>
    <div class="col-xs-6 dashboard-menu">
      <div class="dashboard-menu-item">
        <i class="fas fa-exclamation-triangle" style="color:#9c9c9c"></i>
        <%= link_to "Notify Contacts", emergency_path, method: :post, :class=> "help" %>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-6 dashboard-menu">
      <div class="dashboard-menu-item">
        <i class="fas fa-phone" style="color:#9c9c9c" height="50px"></i>
        <button type="button" class="contact-button" data-toggle="modal" data-target=".bd-example-modal-sm">Add emergency contact</button>
      </div>
    </div>
    <div class="col-xs-6 dashboard-menu">
      <div class="dashboard-menu-item">
        <i class="far fa-comments" style="color:#9c9c9c"></i>
        <div class="small-font"><p>Going out for your event?</p></div>
        <%= link_to "Connect with Chatbot", dashboard_path, :class=> "help" %>
      </div>
    </div>

  <div class="accordion" id="accordionExample">
    <div class="card">
      <div class="card-header" id="headingOne">
        <h5 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
            Events
          </button>
        </h5>
      </div>

      <div id="collapseOne" class="collapse" aria-labelledby="headingOne" data-parent="#accordionExample">
        <div class="card-body">
          <div class="event-cards">
            <% if @events.count >= 1  %>
              <% @events.each do |event| %>
              <%= link_to event_path(event) do %>
                <div class="row">
                  <%= event.name %>
                  <p>From:</p>
                  <%= event.start_date.strftime("%-d/%-m/%y: %k:00") %>
                  <p>To: </p>
                  <%= event.end_date.strftime("%-d/%-m/%y: %k:00") %>
                </div>
                <div class="row">
                  <%= event.description %>
                </div>
                <div class="row">
                  <p>Contacts to notify:</p>
                  <%= event.emergency_contacts.pluck(:first_name).join(", ") %>
                </div>
                <div class="row">
                  <%= event.location %>
                  <div> <img src="https://maps.googleapis.com/maps/api/staticmap?center=<%= CGI.escape "#{event.location}" %>&zoom=13&size=600x300&maptype=roadmap&markers=color:blue%7Clabel:S%7C<%= event.latitude %>,<%= event.longitude %>&key=AIzaSyDAC0TPT8VTsQ64MxkQT8gz9O9bGOfLUfs" class="event-map"> </div>
                </div>
              <% end %>
              <% end %>
            <% else %>
              <div class="no-events">You have no events to display</div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="card-header" id="headingTwo">
        <h5 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            Emergency Contacts
          </button>
        </h5>
      </div>
      <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
        <div class="card-body">
          <% @emergency_contacts.each do |emergency_contact| %>
          <div class="row" id="emerg-contact-row">
            <div class="col-xs-5">
              <%= emergency_contact.first_name %>
              <%= emergency_contact.last_name %>
            </div>
            <div id="phone-icon" class="col-xs-5">
              <i class="fas fa-phone"></i>
              <%= emergency_contact.phone_number %>
            </div>
            <div class="col-xs-2">
              <%= link_to emergency_contact_path(emergency_contact),
                  method: :delete,
                  data: { confirm: "Are you sure?" } do %>
              <i class="far fa-trash-alt"></i>
              <% end %>
            </div>
          </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>



</div>


<div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Add an Event</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="event-form-container">
        <div class="col-xs-12">
        <%= simple_form_for @event do |f| %>
        <div class="form-input">
        <%= f.input :name %>
          <div class="event-dates-container">
          <div class="col-xs-6">
        <label>Event starts:</label>
        <input name="start_date" class="flatpickr flatpickr-input form-control" placeholder="date" id= "start-day" data-dateFormat="l, F j, Y" value="<%= @event.start_date %> ">
        <input name="start_time" class="flatpickr form-control" placeholder="time" id="start-time" value="<%= @event.start_date %> " >
                </div>
       <div class="col-xs-6">
       <label>Event ends:</label>
       <input name="end_date" class="flatpickr flatpickr-input form-control" placeholder="date"id= "end-day" data-dateFormat="l, F j, Y" value="<%= @event.end_date %> ">
       <input name="end_time" class="flatpickr form-control" placeholder="time" id="end-time" value="<%= @event.end_date %> ">
     </div>
   </div>
        <%= f.input :description %>
        <%= render 'layouts/autocomplete' , event_location: @event.location %>
        <%= f.association :emergency_contacts, as: :check_boxes, collection: current_user.emergency_contacts.order(:first_name), value_method: :first_name, label_method: :first_name  %>
        <%= f.input :active, :as => :hidden %>
         <div class="col-xs-12"><%= f.submit "Add Event", class: "btn btn-standard"%></div>
        <% end %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
</div>
</div>
</div>


<div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <h5 class="modal-title">Add an emergency contact</h5>
         <div class="event-form-container">
          <div class="col-xs-12">
        <%= simple_form_for @emergency_contact do |f| %>
         <div class="form-input">
          <%= f.input :first_name %>
          <%= f.input :last_name %>
          <%= f.input :phone_number %>
          <%= f.submit "Add Contact", class: "btn btn-standard" %>
        <% end %>
         </div>
       </div>
      </div>
    </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

